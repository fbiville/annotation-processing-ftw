<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Niveau 1</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Niveau 1</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_exo_1_en_ligne_de_commande">exo 1: en ligne de commande !</a>
<ul class="sectlevel2">
<li><a href="#_étape_1_compiler_un_annotation_processor">étape 1: compiler un annotation processor</a></li>
<li><a href="#_étape_2_utiliser_un_annotation_processor">étape 2: utiliser un annotation processor</a></li>
<li><a href="#_étape_3_bonus">étape 3: bonus</a></li>
</ul>
</li>
<li><a href="#_exo_2_rounds_et_cycle_de_vie">exo 2: rounds et cycle de vie</a>
<ul class="sectlevel2">
<li><a href="#_étape_1_activer_les_logs_des_rounds">étape 1: activer les logs des rounds</a></li>
<li><a href="#_étape_2_supprimer_le_doublon_à_la_bourrin">étape 2: supprimer le doublon à la bourrin</a></li>
<li><a href="#_étape_3_supprimer_le_doublon_proprement">étape 3: supprimer le doublon proprement</a></li>
</ul>
</li>
<li><a href="#_exo3_la_même_chose_avec_maven">exo3: la même chose avec Maven</a>
<ul class="sectlevel2">
<li><a href="#_étape_1_déclarer_le_processor">étape 1: déclarer le processor</a></li>
<li><a href="#_étape_2_activer_les_logs">étape 2: activer les logs</a></li>
<li><a href="#_étape_3_les_niveaux_de_diagnostic_et_maven">étape 3: les niveaux de diagnostic et Maven</a></li>
</ul>
</li>
<li><a href="#_exo4_découverte_automatique_des_processors">exo4: découverte automatique des processors</a>
<ul class="sectlevel2">
<li><a href="#_étape_1_se_passer_de_déclaration_explicite_du_processor">étape 1: se passer de déclaration explicite du processor</a></li>
<li><a href="#_étape_2_automatiser_encore_plus">étape 2: automatiser encore plus</a></li>
<li><a href="#_étape_3_la_bonne_gestion_des_dépendances_de_type_annotation_processor">étape 3: la bonne gestion des dépendances de type annotation processor</a></li>
<li><a href="#_étape_4_bonus_contourner_les_bugs_du_maven_compiler_plugin">étape 4: bonus, contourner les bugs du maven-compiler-plugin</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_exo_1_en_ligne_de_commande">exo 1: en ligne de commande !</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_étape_1_compiler_un_annotation_processor">étape 1: compiler un annotation processor</h3>
<div class="paragraph">
<p>Le première étape de l&#8217;exercice consiste à utiliser <code>javac</code> en ligne de commande pour compiler un annotation processor.</p>
</div>
<div class="paragraph">
<p>La compilation d&#8217;un annotation processor est identique à n&#8217;importe quelle classe.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Essayez de compiler <code>StutteringHelloWorldProcessor.java</code> qui se trouve dans le répertoire exo1 (le plus simple fonctionne).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution: cd exo1 &amp;&amp; javac StutteringHelloWorldProcessor</p>
</div>
</div>
<div class="sect2">
<h3 id="_étape_2_utiliser_un_annotation_processor">étape 2: utiliser un annotation processor</h3>
<div class="paragraph">
<p>Pour utiliser en annotation processor, il suffit de spécifier à <code>javac</code> le nom de la ou les classes à utiliser via un argument de la ligne de commande lors de la compilation.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Essayez de compiler <code>SomeDeprecatedClass.java</code> (ici encore, le plus simple fonctionnera).</p>
</div>
<div class="paragraph">
<p>Vous devez voir s&#8217;afficher les 2 lignes suivantes dans la console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Note: Hello world!
Note: Hello world!</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution: cd exo1 &amp;&amp; javac -processor StutteringHelloWorldProcessor SomeDeprecatedClass.java</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Maintenant, compilez en même temps <code>SomeDeprecatedClass.java</code> et <code>SomeOtherDeprecatedClass.java</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Constatez que le résultat dans la console est le même. Nous allons rechercher l&#8217;explication et corriger ce bégaiement dans le prochain exercice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_étape_3_bonus">étape 3: bonus</h3>
<div class="paragraph">
<p>Vous pouvez vérifier qu&#8217;aucun message ne s&#8217;affiche si vous commentez l&#8217;annotation <code>@Deprecated</code> des classes que vous compilez (<code>SomeDeprecatedClass</code> et/ou <code>SomeOtherDeprecatedClass.java</code>).</p>
</div>
<div class="paragraph">
<p>Vous pouvez vérifier le comportement de <code>javac</code> si vous spécifiez le nom d&#8217;un annotation processor qui ne se trouve pas dans le class path.</p>
</div>
<div class="paragraph">
<p>etc&#8230;&#8203;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exo_2_rounds_et_cycle_de_vie">exo 2: rounds et cycle de vie</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lors de l&#8217;étape 2 de l&#8217;exo 1, vous vous êtes sûrement demandé pour quelle raison deux lignes s&#8217;affichent et constaté que ce n&#8217;est pas lié au nombre de fichiers compilés.</p>
</div>
<div class="paragraph">
<p>Ce comportement est en réalité lié au mécanisme de "round" de l&#8217;annotation processing et à l&#8217;implémentation de <code>HelloWorldProcessor.java</code> que nous utilisons.</p>
</div>
<div class="sect2">
<h3 id="_étape_1_activer_les_logs_des_rounds">étape 1: activer les logs des rounds</h3>
<div class="paragraph">
<p>Une option de <code>javac</code> permet d&#8217;activer les logs des rounds d&#8217;annotations processing. Consultez la doc de <code>javac</code> pour l&#8217;identifier.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Compilez <code>HelloWorldProcessor.java</code> dans le répertoire <code>exo2</code> puis <code>SomeDeprecatedClass</code> en activant les logs des rounds. (TODO: lien doc)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution: cd exo2 &amp;&amp; javac -XprintRounds -processor HelloWorldProcessor SomeDeprecatedClass.java</p>
</div>
<div class="paragraph">
<p>Constatez qu&#8217;il y a deux rounds, ce qui explique l&#8217;affichage du "Hello world!" en doublon.</p>
</div>
<div class="paragraph">
<p>Une autre option permet d&#8217;afficher pour chaque round quels sont les processors que javac fait participer.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Compilez <code>SomeDeprecatedClass</code> en activant les deux options.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution: cd exo2 &amp;&amp; javac -XprintRounds -XprintProcessorInfo -processor HelloWorldProcessor SomeDeprecatedClass.java</p>
</div>
</div>
<div class="sect2">
<h3 id="_étape_2_supprimer_le_doublon_à_la_bourrin">étape 2: supprimer le doublon à la bourrin</h3>
<div class="paragraph">
<p>Le cycle de vie d&#8217;un objet implémentation l&#8217;interface <code>Processor</code> est le suivant (citation de la JSR-269, javadoc de l&#8217;interface <code>Processor</code>):</p>
</div>
<div class="paragraph">
<p>Each implementation of a Processor must provide a public no-argument constructor to be used by tools to instantiate the processor. The tool infrastructure will interact with classes implementing this interface as follows:
    1. If an existing Processor object is not being used, to create an instance of a processor the tool calls the no-arg constructor of the processor class.
    2. Next, the tool calls the init method with an appropriate ProcessingEnvironment.
    3. Afterwards, the tool calls getSupportedAnnotationTypes, getSupportedOptions, and getSupportedSourceVersion. These methods are only called once per run, not on each round.
    4. As appropriate, the tool calls the process method on the Processor object; a new Processor object is not created for each round.</p>
</div>
<div class="paragraph">
<p>En substance, il faut comprendre qu&#8217;une seule instance d&#8217;un annotation processor est créé par compilation. Il est donc tout à fait possible de traiter ce problème en exploitant l&#8217;aspect "statefull" des instances d&#8217;annotation processor (ici, c&#8217;est pas très propre, mais ça marche, et dans la vraie vie, c&#8217;est parfois indispensable).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Modifiez la classe <code>HelloWorldProcessor</code> de sorte que le message ne s&#8217;affiche plus qu&#8217;une seule fois par compilation
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution: il suffit d&#8217;un flag stockée en propriété de la classe <code>HelloWorldProcessor</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_étape_3_supprimer_le_doublon_proprement">étape 3: supprimer le doublon proprement</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Corrigez le doublon en utilisant l&#8217;API (astuce: regardez du côté de <code>RoundEnvironment</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  @Override
  public boolean process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv) {
    if (roundEnv.processingOver()) {
      processingEnv.getMessager().printMessage(Diagnostic.Kind.NOTE, "Hello world!");
    }
    return false;
  }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exo3_la_même_chose_avec_maven">exo3: la même chose avec Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dans le répertoire <code>exo3</code>, vous trouverez deux projets Maven et les classes de l&#8217;exo 2:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>répertoire <code>processor</code>: le projet <code>processor-exo3</code> produit un <code>jar</code> qui contient la classe <code>fr.devoxx.niveau1.exo3.HelloWorldProcessor</code>.</p>
</li>
<li>
<p>répertoire <code>subject</code>: le projet <code>subject-exo3</code> contient la classe <code>fr.devoxx.niveau1.exo3.SomeDeprecatedClass</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_étape_1_déclarer_le_processor">étape 1: déclarer le processor</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Compilez le projet <code>processor-exo3</code> (pensez au <code>install</code>) puis <code>subject-exo3</code> (<code>compile</code> suffit). Constatez qu&#8217;aucune ligne <code>Hello world!</code> ne s&#8217;affiche dans les traces Maven.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>De la même manière qu&#8217;en utilisant <code>javac</code> à la main il faut ajouter une ligne de commande pour déclarer un annotation processor, avec Maven il faut ajouter quelques lignes dans le <code>pom.xml</code>.</p>
</div>
<div class="paragraph">
<p>Le plugin Maven qui se charge de la compilation (et fait donc l&#8217;interface entre Maven et le compilateur) est le <code>maven-compiler-plugin</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Trouvez comment déclarer le processor <code>fr.devoxx.niveau1.exo3.HelloWorldProcessor</code> (TODO: lien doc), recompilez et consatez que le message suivant s&#8217;affiche dans les logs Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[WARNING] Hello world!</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution:
ajout dans la configuration de <code>maven-compiler-plugin</code> des 3 lignes suivantes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;annotationProcessors&gt;
  &lt;annotationProcessor&gt;fr.devoxx.niveau1.exo3.HelloWorldProcessor&lt;/annotationProcessor&gt;
&lt;/annotationProcessors&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_étape_2_activer_les_logs">étape 2: activer les logs</h3>
<div class="paragraph">
<p>L&#8217;activation des logs liés au processing d&#8217;annotations passait par des options de ligne de commande, tout comme la déclaration d&#8217;un processor. Avec maven donc, pour activer ces logs, on utilisera aussi des options de configuration du maven-compiler-plugin.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
modifiez le pom.xml de <code>subject-exo3</code> de sorte que les logs du processing d&#8217;annotations s&#8217;affichent dans les logs du build maven.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">  &lt;compilerArgs&gt;
    &lt;compilerArg&gt;-XprintRounds&lt;/compilerArg&gt;
    &lt;compilerArg&gt;-XprintProcessorInfo&lt;/compilerArg&gt;
  &lt;/compilerArgs&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_étape_3_les_niveaux_de_diagnostic_et_maven">étape 3: les niveaux de diagnostic et Maven</h3>
<div class="paragraph">
<p>Le niveau de log utilisé dans l&#8217;implémentation Maven de <code>HelloWorldProcessor</code> n&#8217;est pas le même que dans l&#8217;implémentation pour <code>javac</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Pour comprendre pourquoi, faites un test avec les valeurs <code>NOTE</code> puis <code>WARNING</code> (et <code>OTHER</code> si vous y tenez) de l&#8217;enum <code>javax.tools.Diagnostic.Kind</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ce comportement est un "choix" du plugin <code>maven-compiler-plugin</code> pour réduire la quantité de logs Maven (sic!) durant la phase compilation.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Trouvez l&#8217;option du plugin permet l&#8217;affichage des warnings de compilation dans Maven (TODO: lien doc).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>solution: ajouter <code>&lt;showWarnings&gt;true&lt;/showWarnings&gt;</code> dans la configuration de <code>maven-compiler-plugin</code> pour afficher <code>WARNING</code>, <code>NOTES</code> et <code>OTHER</code> au niveau <code>[INFO]</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Tentez maintenant la compilation avec le niveau <code>ERROR</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Constatez que vous avez maintenant dans vos mains le moyen de contrôler la compilation de vos classes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Par ailleurs, ce comportement permet de comprendre pourquoi on utilise une enum qui s&#8217;appelle <code>Diagnostic.Kind</code> et non quelque chose comme <code>Level</code>. En principe, on n&#8217;enregistre pas un log mais on transmet un diagnostic au compilateur (sous forme de message), en le qualifiant. Charge au compilateur ensuite de choisir ce qu&#8217;il en fait. Dans les faits, cela revient à afficher un log sauf si c&#8217;est le niveau <code>ERROR</code> auquel cas le compilateur arrête également la compilation.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exo4_découverte_automatique_des_processors">exo4: découverte automatique des processors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;obligation de déclarer explicitement son processor est un handicap au déploiement d&#8217;une solution basée sur un annotation processor.</p>
</div>
<div class="paragraph">
<p>Heureusement, la JSR-269 spécifie la présence d&#8217;un "discovery process". Celui de <code>javac</code> est basé sur le <code>ServiceLoader</code> de l&#8217;API Java.</p>
</div>
<div class="sect2">
<h3 id="_étape_1_se_passer_de_déclaration_explicite_du_processor">étape 1: se passer de déclaration explicite du processor</h3>
<div class="paragraph">
<p>La documentation de <code>javac</code> indique:</p>
</div>
<div class="quoteblock">
<blockquote>
Processors are located by means of service provider-configuration files named META-INF/services/javax.annotation.processing.Processor on the search path
</blockquote>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ajoutez le fichier dans le répertoire <code>src/main/resources</code> du projet <code>exo4-processor1</code> avec comme seul contenu le nom qualifié de la classe <code>DeprecatedCodeWhistleblower</code> sur une ligne.</p>
</div>
<div class="paragraph">
<p>Recompilez tout le projet (<code>mvn clean install</code>). Le message suivant s&#8217;affiche dans la console lors de la compilation du module <code>exo4-subject1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[WARNING] Attention, il y a du code déprécié dans les sources de ce module !</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Félicitations ! Il suffit maintenant d&#8217;avoir l&#8217;artefact <code>fr.devoxx.2015.niveau1:exo4-processor1</code> comme dépendance avec le scope <code>compile</code> pour bénéficier de ses avertissements (super utiles) à la compilation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_étape_2_automatiser_encore_plus">étape 2: automatiser encore plus</h3>
<div class="paragraph">
<p>La création du fichier <code>META-INF/services/javax.annotation.processing.Processor</code> et l&#8217;écriture de son contenu sont un exemple parfait de ce qui peut être automatisé avec le processing d&#8217;annotation à la compilation.</p>
</div>
<div class="paragraph">
<p>Et pour preuve, c&#8217;est le but de la toute petite (3 classes) librairie <code>AutoService</code>.</p>
</div>
<div class="paragraph">
<p>Préparez votre totem, vous allez faire de l&#8217;annotation processing sur un annotation processor.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ajoutez la dépendance <code>com.google.auto.service:auto-service</code> au module <code>exo4-processor2</code>, puis l&#8217;annotation <code>@AutoService(Processor.class)</code> sur la classe <code>OverrideJohns</code>. Relancez la compilation de tout le projet, vous devez voir apparaître la ligne suivante lors de la compilation du module <code>exo4-subject2</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[WARNING] True rewards await those who choose wisely.</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fantastique ! Ca fonctionne ! Il est possible de faire de l&#8217;annotation processing alors même que l&#8217;on code un processor, pas mal non ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_étape_3_la_bonne_gestion_des_dépendances_de_type_annotation_processor">étape 3: la bonne gestion des dépendances de type annotation processor</h3>
<div class="paragraph">
<p>Vous aurez sûrement remarqué que la ligne produite par <code>DeprecatedCodeWhistleblower</code> ("[WARNING] Attention, il y a du code déprécié dans les sources de ce module !") est aussi présente lors de la compilation du module <code>exo4-subject2</code>.</p>
</div>
<div class="paragraph">
<p>Comme ce processor utilise un "service provider-configuration files", cela signifie que le module <code>exo4-subject2</code> déclare une dépendance vers le module <code>exo4-processor1</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Vérifiez le <code>pom.xml</code> et constatez que ce n&#8217;est pas le cas.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En réalité, le module <code>exo4-processor1</code> est une dépendance indirecte du module <code>exo4-subject2</code>. En effet, celui-ci déclare une dépendance vers <code>exo4-subject1</code>, qui déclare une dépendance à <code>exo4-processor1</code>.</p>
</div>
<div class="paragraph">
<p>Du coup, <code>exo4-processor1</code> est bien dans le classpath de <code>exo4-subject2</code> et il se voit donc appliqué le processor de ce module.</p>
</div>
<div class="paragraph">
<p>Ce comportement est rarement souhaitable. Heureusement, il existe une option de la déclaration de dépendance Maven qui permet de le corriger, de faire en sorte d&#8217;avoir une dépendance de scope <code>compile</code> mais que celle-ci ne puisse être tirée indirectement.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Faites en sorte que la ligne de log du processor <code>DeprecatedCodeWhistleblower</code> ne s&#8217;affiche plus lors de la compilation du module <code>exo4-subject2</code> sans modifier le <code>pom.xml</code> de <code>exo4-subject2</code>. (astuce: la doc de <code>@AutoValue</code> est correcte de ce point de vue)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_étape_4_bonus_contourner_les_bugs_du_maven_compiler_plugin">étape 4: bonus, contourner les bugs du maven-compiler-plugin</h3>
<div class="paragraph">
<p>Si vous regardez le <code>pom.xml</code> du module <code>exo4-processor1</code>, vous constaterez qu&#8217;une option du compilateur a été ajoutée pour désactiver totalement le processing d&#8217;annotation lors de la compilation de ce module.</p>
</div>
<div class="paragraph">
<p>Cette option est super-extrèmement-ultra-vachement importante si vous écrivez <code>META-INF/services/javax.annotation.processing.Processor</code> à la main.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Supprimez cette option, compilez le projet.</p>
</div>
<div class="paragraph">
<p>Constatez que le build échoue avec le message suivant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ERROR] Bad service configuration file, or exception thrown while constructing Processor object: javax.annotation.processing.Processor: Provider fr.devoxx.niveau1.exo4.DeprecatedCodeWhistleblower not found</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cette erreur signifie que Java n&#8217;a pas trouvé un processor alors que celui-ci est référencé dans un fichier <code>META-INF/services/javax.annotation.processing.Processor</code>. Mais bon, forcément, il ne trouve pas un processor qu&#8217;il est censé compiler.</p>
</div>
<div class="paragraph">
<p>L&#8217;explication de se comportement n&#8217;est pas triviale, mais la voici. Lors du build:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Maven copie les ressources dans le répertoire <code>exo4-processor1/target/classes</code></p>
</li>
<li>
<p>lors de la compilation, le <code>maven-compiler-plugin</code> spécifie à <code>javac</code> que le répertoire <code>exo4-processor1/target/classes</code> fait partie de son classpath (un [ticket](<a href="https://jira.codehaus.org/browse/MCOMPILER-97" class="bare">https://jira.codehaus.org/browse/MCOMPILER-97</a>) est ouvert sur le sujet depuis des années mais ce choix est requis pour le build incrémental)</p>
</li>
<li>
<p><code>javac</code> constate donc la présence d&#8217;un fichier <code>META-INF/services/javax.annotation.processing.Processor</code> dans le classpath et recherche donc le processor indiqué: <code>DeprecatedCodeWhistleblower</code></p>
</li>
<li>
<p>ce processor n&#8217;existe pas (forcément, on est sur le point de le compiler) et <code>javac</code> lève une erreur et ne compile aucun fichier</p>
</li>
<li>
<p>l&#8217;erreur ("error: Bad service configuration file, or exception thrown while constructing Processor object: javax.annotation.processing.Processor: Provider fr.devoxx.niveau1.exo4.DeprecatedCodeWhistleblower not found") est remontée par le <code>maven-compiler-plugin</code> et le build échoue</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le workaround qui est "prescrit" pour ce problème est celui indiqué ci-dessus: désactiver l&#8217;annotation processing complètement lors de la compilation du processor.</p>
</div>
<div class="paragraph">
<p>Ce workaround est acceptable à la condition d&#8217;avoir isolé le processor dans son propre module (ce qui est une bonne pratique de toute manière) et/ou que l&#8217;on a pas besoin d&#8217;annotation processing de toute façon.</p>
</div>
<div class="paragraph">
<p>L&#8217;autre workaround consiste à utiliser l&#8217;annotation <code>@AutoService</code>.</p>
</div>
<div class="sect3">
<h4 id="_c_est_pire_avec_java_6_et_7">c&#8217;est pire avec Java 6 et 7</h4>
<div class="paragraph">
<p>Attention, le build n&#8217;échoue que si Maven est exécuté avec Java 8. Avec Java 7 et 6, javac ne rapporte aucune erreur (bug corrigé en 8) et ne compile toujours aucune classe. Donc voici la situation que l&#8217;on reprend au point 5:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>l&#8217;erreur ("error: Bad service configuration file, or exception thrown while constructing Processor object: javax.annotation.processing.Processor: Provider fr.devoxx.niveau1.exo4.DeprecatedCodeWhistleblower not found") est simplement ignorée par le <code>maven-compiler-plugin</code> (bug! gros bug!) qui considère que la compilation a réussi</p>
</li>
<li>
<p>la compilation de <code>exo4-processor1</code> produit donc un jar qui ne contient que <code>META-INF/services/javax.annotation.processing.Processor</code></p>
</li>
<li>
<p>ce jar est tiré par les modules <code>exo4-subject1</code> et <code>exo4-subject2</code>, il y a donc dans le classpath un fichier <code>META-INF/services/javax.annotation.processing.Processor</code> qui référence un processor inexistant, <code>javac</code> lève une erreur et la compilation n&#8217;a pas lieu</p>
</li>
<li>
<p>s&#8217;il n&#8217;y a pas de compilation, le message de <code>OverrideJohns</code> ne peut pas s&#8217;afficher, pas de plus que celui de <code>DeprecatedCodeWhistleblower</code> qui n&#8217;a pas été compilé</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>En conclusion, la présence d&#8217;un fichier <code>META-INF/services/javax.annotation.processing.Processor</code> sans son processor peut sérieusement compromettre la compilation. Et encore plus celle d&#8217;un projet Maven dû à certains bugs du <code>maven-compiler-plugin</code> si vous n&#8217;utilisez pas Java 8.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-02-24 15:58:53 CET
</div>
</div>
</body>
</html>